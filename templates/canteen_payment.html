<!-- canteen_payment.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pay Canteen Order</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body>
  <div class="container mt-5">
    <div class="card shadow">
      <div class="card-body text-center">
        <h3>Pay ${{ amount }} for Order #{{ order_id }}</h3>
        <button id="rzp-button" class="btn btn-success btn-lg mt-3">Pay with Razorpay</button>
      </div>
    </div>
  </div>
  <script>
    document.getElementById('rzp-button').onclick = function(e) {
      var options = {
        "key": "{{ key }}",
        "amount": {{ order.amount }},
        "currency": "INR",
        "name": "Hospital Canteen",
        "description": "Order #{{ order_id }}",
        "order_id": "{{ order.id }}",
        "handler": function (response) {
          const form = document.createElement('form');
          form.method = 'POST';
          form.action = "{{ url_for('canteen_payment_success', order_id=order_id) }}";
          const fields = ['razorpay_order_id', 'razorpay_payment_id', 'razorpay_signature'];
          fields.forEach(f => {
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = f;
            input.value = response[f];
            form.appendChild(input);
          });
          document.body.appendChild(form);
          form.submit();
        },
        "prefill": {
          "name": "{{ session.patient.name if session.patient else '' }}",
          "email": "{{ session.patient.email if session.patient else '' }}",
          "contact": "{{ session.patient.mobile if session.patient else '' }}"
        }
      };
      var rzp = new Razorpay(options);
      rzp.open();
      e.preventDefault();
    }
  </script>
</body>
</html>